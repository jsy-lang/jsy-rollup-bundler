import { promisify } from 'util';
import { readFile } from 'fs';
import { dirname, join, relative } from 'path';
import chokidar from 'chokidar';

function asJSONServerSentEvents(res, subscriptionSet) {
  res.socket.setTimeout(0).setKeepAlive(true).setNoDelay(true);
  res.writeHead(200, {
    'Content-Type': 'text/event-stream',
    'Cache-Control': 'no-cache',
    'Connection': 'keep-alive' });

  res.once('error', shutdown);
  res.once('close', shutdown);

  let write = res.write.bind(res);
  res = undefined;

  if (null != subscriptionSet) {
    subscriptionSet.add(sendJSONData);
  }

  write(`\n\n:sse ready\n\n`);
  return sendJSONData;

  function sendJSONData(obj) {
    if (undefined !== write) {
      write(`data: ${JSON.stringify(obj)}\n\n`);
      return true;
    }
  }

  function shutdown(...args) {
    write = undefined;
    if (null != subscriptionSet) {
      subscriptionSet.delete(sendJSONData);
    }
  }
}

const readFile$1 = promisify(readFile);

const rx_data_live = /data-live-([a-z-]+)=(?:'([^']+)'|"([^"]+)")/g;
function replaceDataLive(webroot, data_live, source) {
  return source.replace(rx_data_live, (m, attr, val_a, val_b) => {
    const key = relative(webroot, join(webroot, val_a || val_b));
    return `${attr}='${data_live[key]}' data-live='${attr} ${key}'`;
  });
}

const renderDataLiveView = __express;
async function __express(filePath, locals, callback) {
  const { webroot, data_live } = locals.settings.data_live_info;
  try {
    const source = await readFile$1(filePath, 'utf-8');
    const res = await replaceDataLive(webroot, data_live, source);
    callback(null, res);
  } catch (err) {
    callback(err);
  }
}

function _initOptions(options) {
  if (!options) {
    options = {};
  }
  if (undefined === options.view) {
    options.view = true;
  }
  if (undefined === options.useProduction) {
    options.useProduction = 'production' == process.env.NODE_ENV;
  }
  return options;
}

function initExpressLiveLoader(app, webroot, options = {}) {
  options = _initOptions(options);
  const { useProduction } = options;

  const live_info = initLiveLoader(webroot, options);
  app.set('data_live_info', live_info);

  if (options.view) {
    if (true === options.view) {
      options.view = 'html';
      app.set('view engine', 'html');
    }

    app.engine(options.view, renderDataLiveView);
  }

  if (!useProduction) {
    app.get(options.endpoint || '/__live__', (req, res) => asJSONServerSentEvents(res, live_info.subscriptions));
  }

  return live_info;
}

function initLiveLoader(webroot, options) {
  options = _initOptions(options);
  const { useProduction } = options;

  const subscriptions = new Set();
  const production = {},
        development = {};

  const watcher = chokidar.watch(['*.lnk'], { cwd: webroot }).on('add', updateWatchedLnk).on('change', updateWatchedLnk);

  if (useProduction) {
    setTimeout(() => watcher.close(), 60000);
  }

  const self = Object.create(null, {
    subscriptions: { value: subscriptions },
    watcher: { value: watcher } });

  Object.assign(self, {
    webroot, production, development,
    data_live: useProduction ? production : development,
    useProduction });

  return self;

  function live_sendChange(obj) {
    for (const sendChange of subscriptions.values()) {
      sendChange(obj);
    }
  }

  async function updateWatchedLnk(fname) {
    const filePath = join(webroot, fname);
    const key = relative(webroot, filePath.replace(/.lnk$/, ''));
    const tgt = join(dirname(key), (await readFile$1(filePath, 'utf-8')));

    const minified = fname.includes('.min.');
    if (minified) {
      production[key] = tgt;
      production[key.replace('.min.', '.')] = tgt;
    } else if (tgt != development[key]) {
      development[key] = tgt;
      live_sendChange(development);
    }
  }
}

export { asJSONServerSentEvents, rx_data_live, replaceDataLive, renderDataLiveView, __express, initExpressLiveLoader, initLiveLoader };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGl2ZS1zZXJ2ZXIubWpzIiwic291cmNlcyI6WyIuLi9jb2RlL3NlcnZlclNlbnRFdmVudHMuanN5IiwiLi4vY29kZS9saXZlLXNlcnZlci5qc3kiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gYXNKU09OU2VydmVyU2VudEV2ZW50cyhyZXMsIHN1YnNjcmlwdGlvblNldCkgOjpcbiAgcmVzLnNvY2tldC5zZXRUaW1lb3V0KDApLnNldEtlZXBBbGl2ZSh0cnVlKS5zZXROb0RlbGF5KHRydWUpXG4gIHJlcy53cml0ZUhlYWQgQCAyMDAsIEA6XG4gICAgJ0NvbnRlbnQtVHlwZSc6ICd0ZXh0L2V2ZW50LXN0cmVhbSdcbiAgICAnQ2FjaGUtQ29udHJvbCc6ICduby1jYWNoZSdcbiAgICAnQ29ubmVjdGlvbic6ICdrZWVwLWFsaXZlJ1xuXG4gIHJlcy5vbmNlIEAgJ2Vycm9yJywgc2h1dGRvd25cbiAgcmVzLm9uY2UgQCAnY2xvc2UnLCBzaHV0ZG93blxuXG4gIGxldCB3cml0ZSA9IHJlcy53cml0ZS5iaW5kKHJlcylcbiAgcmVzID0gdW5kZWZpbmVkXG5cbiAgaWYgbnVsbCAhPSBzdWJzY3JpcHRpb25TZXQgOjpcbiAgICBzdWJzY3JpcHRpb25TZXQuYWRkIEAgc2VuZEpTT05EYXRhXG5cbiAgd3JpdGUgQCBgXFxuXFxuOnNzZSByZWFkeVxcblxcbmBcbiAgcmV0dXJuIHNlbmRKU09ORGF0YVxuXG4gIGZ1bmN0aW9uIHNlbmRKU09ORGF0YShvYmopIDo6XG4gICAgaWYgdW5kZWZpbmVkICE9PSB3cml0ZSA6OlxuICAgICAgd3JpdGUgQCBgZGF0YTogJHtKU09OLnN0cmluZ2lmeShvYmopfVxcblxcbmBcbiAgICAgIHJldHVybiB0cnVlXG5cbiAgZnVuY3Rpb24gc2h1dGRvd24oLi4uYXJncykgOjpcbiAgICB3cml0ZSA9IHVuZGVmaW5lZFxuICAgIGlmIG51bGwgIT0gc3Vic2NyaXB0aW9uU2V0IDo6XG4gICAgICBzdWJzY3JpcHRpb25TZXQuZGVsZXRlIEAgc2VuZEpTT05EYXRhXG5cbiIsImltcG9ydCB7cHJvbWlzaWZ5fSBmcm9tICd1dGlsJ1xuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnXG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnXG5pbXBvcnQgY2hva2lkYXIgZnJvbSAnY2hva2lkYXInXG5pbXBvcnQgYXNKU09OU2VydmVyU2VudEV2ZW50cyBmcm9tICcuL3NlcnZlclNlbnRFdmVudHMuanN5J1xuXG5jb25zdCByZWFkRmlsZSA9IHByb21pc2lmeSBAIGZzLnJlYWRGaWxlXG5cbmV4cG9ydCB7YXNKU09OU2VydmVyU2VudEV2ZW50c31cblxuZXhwb3J0IGNvbnN0IHJ4X2RhdGFfbGl2ZSA9IC9kYXRhLWxpdmUtKFthLXotXSspPSg/OicoW14nXSspJ3xcIihbXlwiXSspXCIpL2dcbmV4cG9ydCBmdW5jdGlvbiByZXBsYWNlRGF0YUxpdmUod2Vicm9vdCwgZGF0YV9saXZlLCBzb3VyY2UpIDo6XG4gIHJldHVybiBzb3VyY2UucmVwbGFjZSBAIHJ4X2RhdGFfbGl2ZSwgKG0sIGF0dHIsIHZhbF9hLCB2YWxfYikgPT4gOjpcbiAgICBjb25zdCBrZXkgPSBwYXRoLnJlbGF0aXZlIEAgd2Vicm9vdCxcbiAgICAgIHBhdGguam9pbiBAIHdlYnJvb3QsIHZhbF9hIHx8IHZhbF9iXG4gICAgcmV0dXJuIGAke2F0dHJ9PScke2RhdGFfbGl2ZVtrZXldfScgZGF0YS1saXZlPScke2F0dHJ9ICR7a2V5fSdgXG5cblxuZXhwb3J0IGNvbnN0IHJlbmRlckRhdGFMaXZlVmlldyA9IF9fZXhwcmVzc1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIF9fZXhwcmVzcyhmaWxlUGF0aCwgbG9jYWxzLCBjYWxsYmFjaykgOjpcbiAgY29uc3Qge3dlYnJvb3QsIGRhdGFfbGl2ZX0gPSBsb2NhbHMuc2V0dGluZ3MuZGF0YV9saXZlX2luZm9cbiAgdHJ5IDo6XG4gICAgY29uc3Qgc291cmNlID0gYXdhaXQgcmVhZEZpbGUgQCBmaWxlUGF0aCwgJ3V0Zi04J1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IHJlcGxhY2VEYXRhTGl2ZSBAIHdlYnJvb3QsIGRhdGFfbGl2ZSwgc291cmNlXG4gICAgY2FsbGJhY2sobnVsbCwgcmVzKVxuICBjYXRjaCBlcnIgOjpcbiAgICBjYWxsYmFjayhlcnIpXG5cblxuXG5mdW5jdGlvbiBfaW5pdE9wdGlvbnMob3B0aW9ucykgOjpcbiAgaWYgISBvcHRpb25zIDo6IG9wdGlvbnMgPSB7fVxuICBpZiB1bmRlZmluZWQgPT09IG9wdGlvbnMudmlldyA6OlxuICAgIG9wdGlvbnMudmlldyA9IHRydWVcbiAgaWYgdW5kZWZpbmVkID09PSBvcHRpb25zLnVzZVByb2R1Y3Rpb24gOjpcbiAgICBvcHRpb25zLnVzZVByb2R1Y3Rpb24gPSAncHJvZHVjdGlvbicgPT0gcHJvY2Vzcy5lbnYuTk9ERV9FTlZcbiAgcmV0dXJuIG9wdGlvbnNcblxuZXhwb3J0IGZ1bmN0aW9uIGluaXRFeHByZXNzTGl2ZUxvYWRlcihhcHAsIHdlYnJvb3QsIG9wdGlvbnM9e30pIDo6XG4gIG9wdGlvbnMgPSBfaW5pdE9wdGlvbnMob3B0aW9ucylcbiAgY29uc3Qge3VzZVByb2R1Y3Rpb259ID0gb3B0aW9uc1xuXG4gIGNvbnN0IGxpdmVfaW5mbyA9IGluaXRMaXZlTG9hZGVyKHdlYnJvb3QsIG9wdGlvbnMpXG4gIGFwcC5zZXQgQCAnZGF0YV9saXZlX2luZm8nLCBsaXZlX2luZm9cblxuICBpZiBvcHRpb25zLnZpZXcgOjpcbiAgICBpZiB0cnVlID09PSBvcHRpb25zLnZpZXcgOjpcbiAgICAgIG9wdGlvbnMudmlldyA9ICdodG1sJ1xuICAgICAgYXBwLnNldCBAICd2aWV3IGVuZ2luZScsICdodG1sJ1xuXG4gICAgYXBwLmVuZ2luZSBAIG9wdGlvbnMudmlldywgcmVuZGVyRGF0YUxpdmVWaWV3XG5cbiAgaWYgISB1c2VQcm9kdWN0aW9uIDo6XG4gICAgYXBwLmdldCBAIG9wdGlvbnMuZW5kcG9pbnQgfHwgJy9fX2xpdmVfXycsIChyZXEsIHJlcykgPT5cbiAgICAgIGFzSlNPTlNlcnZlclNlbnRFdmVudHMocmVzLCBsaXZlX2luZm8uc3Vic2NyaXB0aW9ucylcblxuICByZXR1cm4gbGl2ZV9pbmZvXG5cbmV4cG9ydCBmdW5jdGlvbiBpbml0TGl2ZUxvYWRlcih3ZWJyb290LCBvcHRpb25zKSA6OlxuICBvcHRpb25zID0gX2luaXRPcHRpb25zKG9wdGlvbnMpXG4gIGNvbnN0IHt1c2VQcm9kdWN0aW9ufSA9IG9wdGlvbnNcblxuICBjb25zdCBzdWJzY3JpcHRpb25zID0gbmV3IFNldCgpXG4gIGNvbnN0IHByb2R1Y3Rpb24gPSB7fSwgZGV2ZWxvcG1lbnQgPSB7fVxuXG4gIGNvbnN0IHdhdGNoZXIgPSBjaG9raWRhclxuICAgIC53YXRjaCBAIFsnKi5sbmsnXSwgQDogY3dkOiB3ZWJyb290XG4gICAgLm9uIEAgJ2FkZCcsIHVwZGF0ZVdhdGNoZWRMbmtcbiAgICAub24gQCAnY2hhbmdlJywgdXBkYXRlV2F0Y2hlZExua1xuXG4gIGlmIHVzZVByb2R1Y3Rpb24gOjpcbiAgICBzZXRUaW1lb3V0IEAgKCkgPT4gd2F0Y2hlci5jbG9zZSgpLCA2MDAwMFxuXG4gIGNvbnN0IHNlbGYgPSBPYmplY3QuY3JlYXRlIEAgbnVsbCwgQHt9XG4gICAgc3Vic2NyaXB0aW9uczogQHt9IHZhbHVlOiBzdWJzY3JpcHRpb25zXG4gICAgd2F0Y2hlcjogQHt9IHZhbHVlOiB3YXRjaGVyXG5cbiAgT2JqZWN0LmFzc2lnbiBAIHNlbGYsIEB7fVxuICAgIHdlYnJvb3QsIHByb2R1Y3Rpb24sIGRldmVsb3BtZW50XG4gICAgZGF0YV9saXZlOiB1c2VQcm9kdWN0aW9uID8gcHJvZHVjdGlvbiA6IGRldmVsb3BtZW50XG4gICAgdXNlUHJvZHVjdGlvblxuXG4gIHJldHVybiBzZWxmXG5cbiAgZnVuY3Rpb24gbGl2ZV9zZW5kQ2hhbmdlKG9iaikgOjpcbiAgICBmb3IgY29uc3Qgc2VuZENoYW5nZSBvZiBzdWJzY3JpcHRpb25zLnZhbHVlcygpIDo6XG4gICAgICBzZW5kQ2hhbmdlKG9iailcblxuICBhc3luYyBmdW5jdGlvbiB1cGRhdGVXYXRjaGVkTG5rKGZuYW1lKSA6OlxuICAgIGNvbnN0IGZpbGVQYXRoID0gcGF0aC5qb2luKHdlYnJvb3QsIGZuYW1lKVxuICAgIGNvbnN0IGtleSA9IHBhdGgucmVsYXRpdmUgQCB3ZWJyb290LCBmaWxlUGF0aC5yZXBsYWNlKC8ubG5rJC8sICcnKVxuICAgIGNvbnN0IHRndCA9IHBhdGguam9pbiBAIHBhdGguZGlybmFtZShrZXkpLCBhd2FpdCByZWFkRmlsZSBAIGZpbGVQYXRoLCAndXRmLTgnXG5cbiAgICBjb25zdCBtaW5pZmllZCA9IGZuYW1lLmluY2x1ZGVzKCcubWluLicpXG4gICAgaWYgbWluaWZpZWQgOjpcbiAgICAgIHByb2R1Y3Rpb25ba2V5XSA9IHRndFxuICAgICAgcHJvZHVjdGlvbltrZXkucmVwbGFjZSgnLm1pbi4nLCcuJyldID0gdGd0XG5cbiAgICBlbHNlIGlmIHRndCAhPSBkZXZlbG9wbWVudFtrZXldIDo6XG4gICAgICBkZXZlbG9wbWVudFtrZXldID0gdGd0XG4gICAgICBsaXZlX3NlbmRDaGFuZ2UgQCBkZXZlbG9wbWVudFxuXG4iXSwibmFtZXMiOlsiYXNKU09OU2VydmVyU2VudEV2ZW50cyIsInJlcyIsInN1YnNjcmlwdGlvblNldCIsInNvY2tldCIsInNldFRpbWVvdXQiLCJzZXRLZWVwQWxpdmUiLCJzZXROb0RlbGF5Iiwid3JpdGVIZWFkIiwib25jZSIsInNodXRkb3duIiwid3JpdGUiLCJiaW5kIiwidW5kZWZpbmVkIiwiYWRkIiwic2VuZEpTT05EYXRhIiwib2JqIiwiSlNPTiIsInN0cmluZ2lmeSIsImFyZ3MiLCJkZWxldGUiLCJyZWFkRmlsZSIsInByb21pc2lmeSIsImZzIiwicnhfZGF0YV9saXZlIiwicmVwbGFjZURhdGFMaXZlIiwid2Vicm9vdCIsImRhdGFfbGl2ZSIsInNvdXJjZSIsInJlcGxhY2UiLCJtIiwiYXR0ciIsInZhbF9hIiwidmFsX2IiLCJrZXkiLCJwYXRoIiwicmVuZGVyRGF0YUxpdmVWaWV3IiwiX19leHByZXNzIiwiZmlsZVBhdGgiLCJsb2NhbHMiLCJjYWxsYmFjayIsInNldHRpbmdzIiwiZGF0YV9saXZlX2luZm8iLCJlcnIiLCJfaW5pdE9wdGlvbnMiLCJvcHRpb25zIiwidmlldyIsInVzZVByb2R1Y3Rpb24iLCJwcm9jZXNzIiwiZW52IiwiTk9ERV9FTlYiLCJpbml0RXhwcmVzc0xpdmVMb2FkZXIiLCJhcHAiLCJsaXZlX2luZm8iLCJpbml0TGl2ZUxvYWRlciIsInNldCIsImVuZ2luZSIsImdldCIsImVuZHBvaW50IiwicmVxIiwic3Vic2NyaXB0aW9ucyIsIlNldCIsInByb2R1Y3Rpb24iLCJkZXZlbG9wbWVudCIsIndhdGNoZXIiLCJjaG9raWRhciIsIndhdGNoIiwiY3dkIiwib24iLCJ1cGRhdGVXYXRjaGVkTG5rIiwiY2xvc2UiLCJzZWxmIiwiT2JqZWN0IiwiY3JlYXRlIiwidmFsdWUiLCJhc3NpZ24iLCJsaXZlX3NlbmRDaGFuZ2UiLCJzZW5kQ2hhbmdlIiwidmFsdWVzIiwiZm5hbWUiLCJ0Z3QiLCJtaW5pZmllZCIsImluY2x1ZGVzIl0sIm1hcHBpbmdzIjoiOzs7OztBQUFlLFNBQVNBLHNCQUFULENBQWdDQyxHQUFoQyxFQUFxQ0MsZUFBckMsRUFBc0Q7TUFDL0RDLE1BQUosQ0FBV0MsVUFBWCxDQUFzQixDQUF0QixFQUF5QkMsWUFBekIsQ0FBc0MsSUFBdEMsRUFBNENDLFVBQTVDLENBQXVELElBQXZEO01BQ0lDLFNBQUosQ0FBZ0IsR0FBaEIsRUFBdUI7b0JBQ0wsbUJBREs7cUJBRUosVUFGSTtrQkFHUCxZQUhPLEVBQXZCOztNQUtJQyxJQUFKLENBQVcsT0FBWCxFQUFvQkMsUUFBcEI7TUFDSUQsSUFBSixDQUFXLE9BQVgsRUFBb0JDLFFBQXBCOztNQUVJQyxRQUFRVCxJQUFJUyxLQUFKLENBQVVDLElBQVYsQ0FBZVYsR0FBZixDQUFaO1FBQ01XLFNBQU47O01BRUcsUUFBUVYsZUFBWCxFQUE2QjtvQkFDWFcsR0FBaEIsQ0FBc0JDLFlBQXRCOzs7UUFFTyxvQkFB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
